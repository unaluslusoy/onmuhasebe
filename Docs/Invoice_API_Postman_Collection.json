{
    "info": {
        "name": "Invoice API - Ön Muhasebe",
        "description": "Complete Invoice Management API collection for testing",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [{
            "key": "base_url",
            "value": "http://localhost/onmuhasebe/public/api",
            "type": "string"
        },
        {
            "key": "access_token",
            "value": "",
            "type": "string"
        },
        {
            "key": "invoice_id",
            "value": "",
            "type": "string"
        }
    ],
    "item": [{
            "name": "1. Auth",
            "item": [{
                    "name": "Login",
                    "event": [{
                        "listen": "test",
                        "script": {
                            "exec": [
                                "if (pm.response.code === 200) {",
                                "    const response = pm.response.json();",
                                "    pm.collectionVariables.set('access_token', response.data.tokens.access_token);",
                                "    pm.environment.set('access_token', response.data.tokens.access_token);",
                                "    console.log('Token saved:', response.data.tokens.access_token.substring(0, 20) + '...');",
                                "}"
                            ]
                        }
                    }],
                    "request": {
                        "method": "POST",
                        "header": [{
                            "key": "Content-Type",
                            "value": "application/json"
                        }],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"password123\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "login"]
                        }
                    }
                },
                {
                    "name": "Create Session",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/create-session",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "create-session"]
                        }
                    }
                }
            ]
        },
        {
            "name": "2. Invoice CRUD",
            "item": [{
                    "name": "Create Sales Invoice",
                    "event": [{
                        "listen": "test",
                        "script": {
                            "exec": [
                                "if (pm.response.code === 201) {",
                                "    const response = pm.response.json();",
                                "    pm.collectionVariables.set('invoice_id', response.data.id);",
                                "    console.log('Invoice created with ID:', response.data.id);",
                                "    console.log('Invoice Number:', response.data.invoice_number);",
                                "}"
                            ]
                        }
                    }],
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"invoice_type\": \"sales\",\n  \"invoice_category\": \"normal\",\n  \"invoice_date\": \"2025-10-03\",\n  \"due_date\": \"2025-11-02\",\n  \"customer_name\": \"Test Müşteri A.Ş.\",\n  \"customer_email\": \"test@musteri.com\",\n  \"customer_phone\": \"0555 123 4567\",\n  \"customer_tax_number\": \"1234567890\",\n  \"customer_tax_office\": \"Kadıköy\",\n  \"customer_address\": \"Test Mahallesi Test Sokak No:1\",\n  \"customer_city\": \"İstanbul\",\n  \"customer_district\": \"Kadıköy\",\n  \"discount_type\": \"percentage\",\n  \"discount_value\": 5,\n  \"currency\": \"TRY\",\n  \"exchange_rate\": 1.0,\n  \"notes\": \"Postman test faturası\",\n  \"is_draft\": false,\n  \"items\": [\n    {\n      \"item_type\": \"product\",\n      \"item_code\": \"PROD001\",\n      \"item_name\": \"Test Ürün 1\",\n      \"description\": \"Test ürün açıklaması\",\n      \"quantity\": 10,\n      \"unit\": \"Adet\",\n      \"unit_price\": 100.00,\n      \"discount_type\": \"percentage\",\n      \"discount_value\": 0,\n      \"tax_rate\": 20\n    },\n    {\n      \"item_type\": \"product\",\n      \"item_code\": \"PROD002\",\n      \"item_name\": \"Test Ürün 2\",\n      \"description\": \"İkinci test ürünü\",\n      \"quantity\": 5,\n      \"unit\": \"Adet\",\n      \"unit_price\": 200.00,\n      \"discount_type\": \"fixed\",\n      \"discount_value\": 50,\n      \"tax_rate\": 20\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"]
                        }
                    }
                },
                {
                    "name": "Get Invoice Details",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}"]
                        }
                    }
                },
                {
                    "name": "List Invoices",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices?page=1&per_page=10",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"],
                            "query": [
                                { "key": "page", "value": "1" },
                                { "key": "per_page", "value": "10" }
                            ]
                        }
                    }
                },
                {
                    "name": "Update Invoice",
                    "request": {
                        "method": "PUT",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"notes\": \"Updated from Postman\",\n  \"internal_notes\": \"Internal note test\",\n  \"discount_value\": 10\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}"]
                        }
                    }
                },
                {
                    "name": "Delete Invoice",
                    "request": {
                        "method": "DELETE",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}"]
                        }
                    }
                }
            ]
        },
        {
            "name": "3. Invoice Workflow",
            "item": [{
                    "name": "Approve Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/approve",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "approve"]
                        }
                    }
                },
                {
                    "name": "Lock Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"locked\": true\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/lock",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "lock"]
                        }
                    }
                },
                {
                    "name": "Unlock Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"locked\": false\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/lock",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "lock"]
                        }
                    }
                },
                {
                    "name": "Cancel Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"reason\": \"Test amaçlı iptal\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/cancel",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "cancel"]
                        }
                    }
                }
            ]
        },
        {
            "name": "4. Payments",
            "item": [{
                    "name": "Record Payment (Partial)",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"payment_date\": \"2025-10-03\",\n  \"amount\": 500.00,\n  \"payment_method\": \"bank_transfer\",\n  \"transaction_reference\": \"TRX123456\",\n  \"notes\": \"İlk ödeme - 500 TL\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/payments",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "payments"]
                        }
                    }
                },
                {
                    "name": "Get Invoice Payments",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/{{invoice_id}}/payments",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "{{invoice_id}}", "payments"]
                        }
                    }
                }
            ]
        },
        {
            "name": "5. Reports & Statistics",
            "item": [{
                    "name": "Get Statistics",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/statistics",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "statistics"]
                        }
                    }
                },
                {
                    "name": "Get Monthly Summary",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/monthly-summary?year=2025&month=10",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "monthly-summary"],
                            "query": [
                                { "key": "year", "value": "2025" },
                                { "key": "month", "value": "10" }
                            ]
                        }
                    }
                },
                {
                    "name": "Get Overdue Invoices",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/overdue",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "overdue"]
                        }
                    }
                },
                {
                    "name": "Get Due Today",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices/due-today",
                            "host": ["{{base_url}}"],
                            "path": ["invoices", "due-today"]
                        }
                    }
                }
            ]
        },
        {
            "name": "6. Invoice Types",
            "item": [{
                    "name": "Create Purchase Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"invoice_type\": \"purchase\",\n  \"invoice_date\": \"2025-10-03\",\n  \"due_date\": \"2025-11-02\",\n  \"customer_name\": \"Tedarikçi A.Ş.\",\n  \"customer_tax_number\": \"9876543210\",\n  \"items\": [\n    {\n      \"item_type\": \"product\",\n      \"item_name\": \"Satın Alınan Ürün\",\n      \"quantity\": 20,\n      \"unit_price\": 50,\n      \"tax_rate\": 20\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"]
                        }
                    }
                },
                {
                    "name": "Create Draft Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"invoice_type\": \"sales\",\n  \"invoice_date\": \"2025-10-03\",\n  \"due_date\": \"2025-11-02\",\n  \"customer_name\": \"Draft Customer\",\n  \"is_draft\": true,\n  \"items\": [\n    {\n      \"item_type\": \"product\",\n      \"item_name\": \"Draft Item\",\n      \"quantity\": 1,\n      \"unit_price\": 100,\n      \"tax_rate\": 20\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"]
                        }
                    }
                },
                {
                    "name": "Create Recurring Invoice",
                    "request": {
                        "method": "POST",
                        "header": [{
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"invoice_type\": \"sales\",\n  \"invoice_date\": \"2025-10-03\",\n  \"due_date\": \"2025-11-02\",\n  \"customer_name\": \"Recurring Customer\",\n  \"is_recurring\": true,\n  \"recurring_frequency\": \"monthly\",\n  \"recurring_interval\": 1,\n  \"recurring_start_date\": \"2025-10-03\",\n  \"recurring_end_date\": \"2026-10-03\",\n  \"items\": [\n    {\n      \"item_type\": \"service\",\n      \"item_name\": \"Monthly Subscription\",\n      \"quantity\": 1,\n      \"unit_price\": 1000,\n      \"tax_rate\": 20\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/invoices",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"]
                        }
                    }
                }
            ]
        },
        {
            "name": "7. Filters",
            "item": [{
                    "name": "Filter by Type (Sales)",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices?invoice_type=sales",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"],
                            "query": [
                                { "key": "invoice_type", "value": "sales" }
                            ]
                        }
                    }
                },
                {
                    "name": "Filter by Status (Unpaid)",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices?payment_status=unpaid",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"],
                            "query": [
                                { "key": "payment_status", "value": "unpaid" }
                            ]
                        }
                    }
                },
                {
                    "name": "Search Invoices",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices?search=Test",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"],
                            "query": [
                                { "key": "search", "value": "Test" }
                            ]
                        }
                    }
                },
                {
                    "name": "Filter by Date Range",
                    "request": {
                        "method": "GET",
                        "header": [{
                            "key": "Authorization",
                            "value": "Bearer {{access_token}}"
                        }],
                        "url": {
                            "raw": "{{base_url}}/invoices?date_from=2025-10-01&date_to=2025-10-31",
                            "host": ["{{base_url}}"],
                            "path": ["invoices"],
                            "query": [
                                { "key": "date_from", "value": "2025-10-01" },
                                { "key": "date_to", "value": "2025-10-31" }
                            ]
                        }
                    }
                }
            ]
        }
    ]
}